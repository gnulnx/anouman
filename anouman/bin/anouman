#!/usr/bin/env bash

USER=`whoami`
if [ $USER == 'root' ];
then
    echo "You need to run this as a normal mode user"
    exit
fi

INITIAL_SETUP=false
if [[ "$@" == *--deploy* ]]
then
    cd ~/

    if [ ! -d ".virtualenvs/anouman" ]; then
        INITIAL_SETUP=true
        echo "Setting up anouman an server"

        echo "Install virtualwrapper"
        sudo pip install virtualenvwrapper -q
        source /usr/local/bin/virtualenvwrapper.sh;

        echo "Setting up anouman virtualenv"
        mkvirtualenv anouman;
        workon anouman;

        echo "Installing django into anouman virtualenv"
        pip install django -q
    
        ## TODO  pip install anouman
        pip install /vagrant/anouman-0.0.1.tar.gz  --upgrade -q
    
        echo "anouman basic setup now finished"
        
    fi
fi

if [ $1 ];
then
    cd ~/
    echo "calling anouman-admin.py $@"
    anouman-admin.py $@
fi


if [ $INITIAL_SETUP == true ]; 
then
    echo "Please add the following lines to your .bash_profile (or equivlanent shell settings file)"
    echo "   source /usr/local/bin/virtualenvwrapper.sh;"
    echo "   workon anouman"
    echo "If you are using BASH (recommended) and would like me to update you .bash_profile enter 'y'"
    read -a ANS
    ANS= $ANS | tr '[A-Z]' '[a-z]'
    if [ $ANS == "y" ];
    then
        echo "source /usr/local/bin/virtualenvwrapper.sh;" >> .bash_profile
        echo "workon anouman" >> .bash_profile
    fi;
fi;
