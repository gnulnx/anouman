#!/usr/bin/env bash

USER=`whoami`
if [ $USER == 'root' ];
then
    echo "You need to run this as a normal mode user"
    exit
fi

if [[ "$@" == *--deploy* ]]
then
  echo "Server time!";

    cd ~/

    if [ ! -d ".virtualenvs/anouman" ]; then
        echo "Setting up anouman an server"

        echo "Install virtualwrapper"
        sudo pip install virtualenvwrapper -q

        echo "Adding variables to .bash_profile"
        source /usr/local/bin/virtualenvwrapper.sh;
        echo "source /usr/local/bin/virtualenvwrapper.sh;" >> .bash_profile

        echo "source /usr/local/bin/anouman" >> .bash_profile
        echo "workon anouman" >> .bash_profile

        echo "Setting up anouman virtualenv"
        mkvirtualenv anouman;
        workon anouman;

        echo "Installing django into anouman virtualenv"
        pip install django -q
    
        ## TODO  pip install anouman
        pip install /vagrant/anouman-0.0.1.tar.gz  --upgrade -q
        #pip install anouman/dist/anouman-0.0.1.tar.gz  --upgrade
    
        lssitepackages
        
        echo "Please add the following lines to your .bash_profile (or equivlanent shell settings file)"
        echo "   source /usr/local/bin/virtualenvwrapper.sh;"
        echo "   workon anouman"
        echo "If you are using BASH (recommended) and would like me to update you .bash_profile enter 'y'"
        read -a ANS
        ANS= $ANS | tr '[A-Z]' '[a-z]'
        if [ $ANS == "y" ]; 
        then
            echo "source /usr/local/bin/anouman" >> .bash_profile
            echo "workon anouman" >> .bash_profile
        fi;
        
        echo "anouman basic setup now finished"
        
    fi
fi

if [ $1 ];
then
    echo "client time!"
    #source .virtualenvs/anouman/bin/activate

    cd ~/
    echo "calling anouman-admin.py $@"
    anouman-admin.py $@
fi


